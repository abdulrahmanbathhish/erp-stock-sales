<!DOCTYPE html>
<html lang="ar" dir="rtl" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-en="Sales - Stock & Sales" data-ar="المبيعات - المخزون والمبيعات">المبيعات - المخزون والمبيعات</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container" style="padding-top: var(--space-4); padding-bottom: 100px;">
        <!-- Page Header -->
        <div class="page-section-header">
            <div>
                <h2 style="margin-bottom: var(--space-2); font-weight: 700; display: flex; align-items: center; gap: var(--space-3);" data-en="New Sale" data-ar="بيع جديد">
                    <i class="bi bi-cart-plus" style="color: var(--color-success);"></i>بيع جديد
                </h2>
                <p class="text-muted" style="margin-bottom: 0;" data-en="Create a new sale transaction" data-ar="إنشاء معاملة بيع جديدة">إنشاء معاملة بيع جديدة</p>
            </div>
        </div>

        <!-- Customer Selector (Optional for Normal Sales) -->
        <div class="card mb-5">
            <div class="card-header" style="background: var(--color-primary-50); border-bottom: 1px solid var(--color-primary-200);">
                <h5 class="mb-0" style="color: var(--color-primary-700);" data-en="Customer Information" data-ar="معلومات العميل">
                    <i class="bi bi-person me-2"></i>معلومات العميل
                </h5>
            </div>
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-8 col-12">
                        <label for="customer-search-input" class="form-label" data-en="Customer (Optional):" data-ar="العميل (اختياري):">العميل (اختياري):</label>
                        <div class="position-relative">
                            <input type="text" 
                                   class="form-control" 
                                   id="customer-search-input" 
                                   placeholder="البحث عن عميل أو اختر بدون عميل..."
                                   data-en="Search customer or select Walk-in..." 
                                   data-ar="البحث عن عميل أو اختر بدون عميل..."
                                   autocomplete="off">
                            <div id="customer-search-results" class="list-group"></div>
                        </div>
                        <input type="hidden" id="selected-customer-id">
                        <small class="text-muted d-block mt-2" id="selected-customer-name" style="display: none;"></small>
                        <small class="text-muted d-block mt-2" data-en="Note: For credit sales, use the Credit Sales page" data-ar="ملاحظة: للمبيعات بالدين، استخدم صفحة المبيعات بالدين">ملاحظة: للمبيعات بالدين، استخدم صفحة المبيعات بالدين</small>
                    </div>
                    <div class="col-md-4 col-12 mt-3 mt-md-0">
                        <button type="button" class="btn btn-outline-secondary w-100" onclick="clearCustomer()" data-en="Clear" data-ar="مسح">مسح</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Search -->
        <div class="card mb-5">
            <div class="card-header">
                <h5 class="mb-0" data-en="Search Product" data-ar="البحث عن منتج">
                    <i class="bi bi-search me-2"></i>البحث عن منتج
                </h5>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <input type="text" 
                           class="form-control form-control-lg" 
                           id="product-search" 
                           placeholder="اكتب اسم المنتج للبحث..."
                           data-en="Type product name to search..." 
                           data-ar="اكتب اسم المنتج للبحث..."
                           autocomplete="off">
                    <div id="search-results" class="list-group"></div>
                </div>
            </div>
        </div>

        <!-- Selected Product Info -->
        <div class="card mb-5" id="product-info" style="display: none;">
            <div class="card-header" style="background: var(--color-info-light); border-bottom: 1px solid var(--color-info);">
                <h5 class="mb-0" style="color: var(--color-info);" data-en="Selected Product" data-ar="المنتج المحدد">
                    <i class="bi bi-box-seam me-2"></i>المنتج المحدد
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 col-12 mb-3 mb-md-0">
                        <p class="mb-3"><strong data-en="Product:" data-ar="المنتج:">المنتج:</strong> <span id="product-name" class="text-primary"></span></p>
                        <p class="mb-0"><strong data-en="Current Stock:" data-ar="المخزون الحالي:">المخزون الحالي:</strong> <span id="product-stock" class="badge bg-secondary"></span></p>
                    </div>
                    <div class="col-md-6 col-12">
                        <p class="mb-3"><strong data-en="Purchase Price:" data-ar="سعر الشراء:">سعر الشراء:</strong> <span id="product-purchase-price" class="text-muted"></span></p>
                        <p class="mb-0"><strong data-en="Default Sale Price:" data-ar="سعر البيع الافتراضي:">سعر البيع الافتراضي:</strong> <span id="product-sale-price" class="text-success fw-bold"></span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sale Form -->
        <div class="card mb-5" id="sale-form" style="display: none;">
            <div class="card-header" style="background: var(--color-success-light); border-bottom: 1px solid var(--color-success);">
                <h5 class="mb-0" style="color: var(--color-success-dark);" data-en="Sale Details" data-ar="تفاصيل البيع">
                    <i class="bi bi-receipt me-2"></i>تفاصيل البيع
                </h5>
            </div>
            <div class="card-body">
                <form id="sale-form-element">
                    <input type="hidden" id="product-id">
                    <div class="row mb-4">
                        <div class="col-md-6 col-12 mb-3 mb-md-0">
                            <label for="quantity" class="form-label" data-en="Quantity" data-ar="الكمية">الكمية</label>
                            <input type="number" 
                                   class="form-control" 
                                   id="quantity" 
                                   min="1" 
                                   required>
                        </div>
                        <div class="col-md-6 col-12">
                            <label for="sale-price" class="form-label" data-en="Sale Price per Unit" data-ar="سعر البيع لكل وحدة">سعر البيع لكل وحدة</label>
                            <input type="number" 
                                   class="form-control" 
                                   id="sale-price" 
                                   step="0.01" 
                                   min="0" 
                                   required>
                        </div>
                    </div>
                    <div class="d-flex flex-column flex-md-row gap-3">
                        <button type="submit" class="btn btn-primary btn-lg" data-en="Add to Cart" data-ar="إضافة إلى السلة">إضافة إلى السلة</button>
                        <button type="button" class="btn btn-secondary btn-lg" onclick="clearForm()" data-en="Clear" data-ar="مسح">مسح</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Success/Error Messages -->
        <div id="alert-container"></div>

        <!-- Shopping Cart -->
        <div class="card mb-5" id="cart-section" style="display: none;">
            <div class="card-header" style="background: var(--color-warning-light); border-bottom: 1px solid var(--color-warning);">
                <h5 class="mb-0" style="color: var(--color-warning-dark);" data-en="Shopping Cart" data-ar="سلة التسوق">
                    <i class="bi bi-cart me-2"></i>سلة التسوق
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th data-en="Product" data-ar="المنتج">المنتج</th>
                                <th data-en="Quantity" data-ar="الكمية">الكمية</th>
                                <th data-en="Sale Price" data-ar="سعر البيع">سعر البيع</th>
                                <th data-en="Total" data-ar="الإجمالي">الإجمالي</th>
                                <th data-en="Actions" data-ar="الإجراءات">الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="cart-items">
                            <tr>
                                <td colspan="5" class="text-center text-muted" data-en="Cart is empty" data-ar="السلة فارغة">السلة فارغة</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="table-info">
                                <th colspan="3" data-en="Total" data-ar="الإجمالي">الإجمالي</th>
                                <th id="cart-total-amount" class="fw-bold">$0.00</th>
                                <th></th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <div class="mt-4 d-flex flex-column flex-md-row gap-3">
                    <button type="button" class="btn btn-success btn-lg flex-fill" id="confirm-all-sales" data-en="Confirm All Sales" data-ar="تأكيد جميع المبيعات">تأكيد جميع المبيعات</button>
                    <button type="button" class="btn btn-secondary btn-lg flex-fill" onclick="clearCart()" data-en="Clear Cart" data-ar="مسح السلة">مسح السلة</button>
                </div>
            </div>
        </div>

        <!-- Latest Sales -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0" data-en="Latest Sales" data-ar="أحدث المبيعات">
                    <i class="bi bi-clock-history me-2"></i>أحدث المبيعات
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped mb-0">
                        <thead>
                            <tr>
                                <th data-en="Date" data-ar="التاريخ">التاريخ</th>
                                <th data-en="Product" data-ar="المنتج">المنتج</th>
                                <th data-en="Quantity" data-ar="الكمية">الكمية</th>
                                <th data-en="Sale Price" data-ar="سعر البيع">سعر البيع</th>
                                <th data-en="Total" data-ar="الإجمالي">الإجمالي</th>
                                <th data-en="Actions" data-ar="الإجراءات">الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="latest-sales">
                            <tr>
                                <td colspan="6" class="text-center" data-en="Loading..." data-ar="جاري التحميل...">جاري التحميل...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/language.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/sales.js"></script>
    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav">
        <a href="home.html" class="bottom-nav__item" data-en="Home" data-ar="الرئيسية">
            <i class="bi bi-house bottom-nav__icon"></i>
            <span class="bottom-nav__label" data-en="Home" data-ar="الرئيسية">الرئيسية</span>
        </a>
        <a href="history.html" class="bottom-nav__item" data-en="History" data-ar="السجل">
            <i class="bi bi-file-text bottom-nav__icon"></i>
            <span class="bottom-nav__label" data-en="History" data-ar="السجل">السجل</span>
        </a>
        <a href="products.html" class="bottom-nav__item" data-en="Products" data-ar="المنتجات">
            <i class="bi bi-box bottom-nav__icon"></i>
            <span class="bottom-nav__label" data-en="Products" data-ar="المنتجات">المنتجات</span>
        </a>
        <a href="customers.html" class="bottom-nav__item" data-en="Customers" data-ar="العملاء">
            <i class="bi bi-people bottom-nav__icon"></i>
            <span class="bottom-nav__label" data-en="Customers" data-ar="العملاء">العملاء</span>
        </a>
        <a href="index.html" class="bottom-nav__item" data-en="Dashboard" data-ar="لوحة التحكم">
            <i class="bi bi-speedometer2 bottom-nav__icon"></i>
            <span class="bottom-nav__label" data-en="Dashboard" data-ar="لوحة التحكم">لوحة التحكم</span>
        </a>
        <a href="expenses.html" class="bottom-nav__item" data-en="Expenses" data-ar="المصروفات">
            <i class="bi bi-wallet bottom-nav__icon"></i>
            <span class="bottom-nav__label" data-en="Expenses" data-ar="المصروفات">المصروفات</span>
        </a>
    </nav>

    <script>
        // Update navigation visibility on page load
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof updateNavigationVisibility === 'function') {
                updateNavigationVisibility();
            }
        });
    </script>
</body>
</html>

